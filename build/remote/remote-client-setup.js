"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var fs = __toESM(require("fs"));
var os = __toESM(require("os"));
var path = __toESM(require("path"));
const SYSTEMD_SERVICE_NAME = "iobroker-ds18b20-remote.service";
const files = {
  'common.js': 'InVzZSBzdHJpY3QiOwp2YXIgX19jcmVhdGUgPSBPYmplY3QuY3JlYXRlOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0VTTSA9IChtb2QsIGlzTm9kZU1vZGUsIHRhcmdldCkgPT4gKHRhcmdldCA9IG1vZCAhPSBudWxsID8gX19jcmVhdGUoX19nZXRQcm90b09mKG1vZCkpIDoge30sIF9fY29weVByb3BzKAogIC8vIElmIHRoZSBpbXBvcnRlciBpcyBpbiBub2RlIGNvbXBhdGliaWxpdHkgbW9kZSBvciB0aGlzIGlzIG5vdCBhbiBFU00KICAvLyBmaWxlIHRoYXQgaGFzIGJlZW4gY29udmVydGVkIHRvIGEgQ29tbW9uSlMgZmlsZSB1c2luZyBhIEJhYmVsLQogIC8vIGNvbXBhdGlibGUgdHJhbnNmb3JtIChpLmUuICJfX2VzTW9kdWxlIiBoYXMgbm90IGJlZW4gc2V0KSwgdGhlbiBzZXQKICAvLyAiZGVmYXVsdCIgdG8gdGhlIENvbW1vbkpTICJtb2R1bGUuZXhwb3J0cyIgZm9yIG5vZGUgY29tcGF0aWJpbGl0eS4KICBpc05vZGVNb2RlIHx8ICFtb2QgfHwgIW1vZC5fX2VzTW9kdWxlID8gX19kZWZQcm9wKHRhcmdldCwgImRlZmF1bHQiLCB7IHZhbHVlOiBtb2QsIGVudW1lcmFibGU6IHRydWUgfSkgOiB0YXJnZXQsCiAgbW9kCikpOwp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CnZhciBjb21tb25fZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChjb21tb25fZXhwb3J0cywgewogIFJFTU9URV9QUk9UT0NPTF9WRVJTSU9OOiAoKSA9PiBSRU1PVEVfUFJPVE9DT0xfVkVSU0lPTiwKICBkZWNyeXB0OiAoKSA9PiBkZWNyeXB0LAogIGVuY3J5cHQ6ICgpID0+IGVuY3J5cHQKfSk7Cm1vZHVsZS5leHBvcnRzID0gX190b0NvbW1vbkpTKGNvbW1vbl9leHBvcnRzKTsKdmFyIGNyeXB0byA9IF9fdG9FU00ocmVxdWlyZSgiY3J5cHRvIikpOwpjb25zdCBSRU1PVEVfUFJPVE9DT0xfVkVSU0lPTiA9IDM7CmNvbnN0IElWX0xFTkdUSCA9IDE2OwpmdW5jdGlvbiBlbmNyeXB0KHRleHQsIGtleSkgewogIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKElWX0xFTkdUSCk7CiAgY29uc3QgY2lwaGVyID0gY3J5cHRvLmNyZWF0ZUNpcGhlcml2KCJhZXMtMjU2LWNiYyIsIGtleSwgaXYpOwogIGxldCBlbmNyeXB0ZWQgPSBjaXBoZXIudXBkYXRlKHRleHQpOwogIGVuY3J5cHRlZCA9IEJ1ZmZlci5jb25jYXQoW2VuY3J5cHRlZCwgY2lwaGVyLmZpbmFsKCldKTsKICByZXR1cm4gaXYudG9TdHJpbmcoImhleCIpICsgIjoiICsgZW5jcnlwdGVkLnRvU3RyaW5nKCJoZXgiKTsKfQpmdW5jdGlvbiBkZWNyeXB0KHRleHQsIGtleSkgewogIGNvbnN0IHRleHRQYXJ0cyA9IHRleHQuc3BsaXQoIjoiKTsKICBjb25zdCBpdiA9IEJ1ZmZlci5mcm9tKHRleHRQYXJ0cy5zaGlmdCgpLCAiaGV4Iik7CiAgY29uc3QgZW5jcnlwdGVkVGV4dCA9IEJ1ZmZlci5mcm9tKHRleHRQYXJ0cy5qb2luKCI6IiksICJoZXgiKTsKICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KCJhZXMtMjU2LWNiYyIsIGtleSwgaXYpOwogIGxldCBkZWNyeXB0ZWQgPSBkZWNpcGhlci51cGRhdGUoZW5jcnlwdGVkVGV4dCk7CiAgZGVjcnlwdGVkID0gQnVmZmVyLmNvbmNhdChbZGVjcnlwdGVkLCBkZWNpcGhlci5maW5hbCgpXSk7CiAgcmV0dXJuIGRlY3J5cHRlZC50b1N0cmluZygpOwp9Ci8vIEFubm90YXRlIHRoZSBDb21tb25KUyBleHBvcnQgbmFtZXMgZm9yIEVTTSBpbXBvcnQgaW4gbm9kZToKMCAmJiAobW9kdWxlLmV4cG9ydHMgPSB7CiAgUkVNT1RFX1BST1RPQ09MX1ZFUlNJT04sCiAgZGVjcnlwdCwKICBlbmNyeXB0Cn0pOwovLyMgc291cmNlTWFwcGluZ1VSTD1jb21tb24uanMubWFwCg==',
'ds18b20-remote-client.js': 'InVzZSBzdHJpY3QiOwp2YXIgX19jcmVhdGUgPSBPYmplY3QuY3JlYXRlOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHsKICBpZiAoZnJvbSAmJiB0eXBlb2YgZnJvbSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGZyb20gPT09ICJmdW5jdGlvbiIpIHsKICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSkKICAgICAgaWYgKCFfX2hhc093blByb3AuY2FsbCh0bywga2V5KSAmJiBrZXkgIT09IGV4Y2VwdCkKICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7CiAgfQogIHJldHVybiB0bzsKfTsKdmFyIF9fdG9FU00gPSAobW9kLCBpc05vZGVNb2RlLCB0YXJnZXQpID0+ICh0YXJnZXQgPSBtb2QgIT0gbnVsbCA/IF9fY3JlYXRlKF9fZ2V0UHJvdG9PZihtb2QpKSA6IHt9LCBfX2NvcHlQcm9wcygKICAvLyBJZiB0aGUgaW1wb3J0ZXIgaXMgaW4gbm9kZSBjb21wYXRpYmlsaXR5IG1vZGUgb3IgdGhpcyBpcyBub3QgYW4gRVNNCiAgLy8gZmlsZSB0aGF0IGhhcyBiZWVuIGNvbnZlcnRlZCB0byBhIENvbW1vbkpTIGZpbGUgdXNpbmcgYSBCYWJlbC0KICAvLyBjb21wYXRpYmxlIHRyYW5zZm9ybSAoaS5lLiAiX19lc01vZHVsZSIgaGFzIG5vdCBiZWVuIHNldCksIHRoZW4gc2V0CiAgLy8gImRlZmF1bHQiIHRvIHRoZSBDb21tb25KUyAibW9kdWxlLmV4cG9ydHMiIGZvciBub2RlIGNvbXBhdGliaWxpdHkuCiAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsICJkZWZhdWx0IiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LAogIG1vZAopKTsKdmFyIGltcG9ydF91dGlsID0gcmVxdWlyZSgidXRpbCIpOwp2YXIgaW1wb3J0X25ldCA9IHJlcXVpcmUoIm5ldCIpOwp2YXIgZnMgPSBfX3RvRVNNKHJlcXVpcmUoImZzIikpOwp2YXIgb3MgPSBfX3RvRVNNKHJlcXVpcmUoIm9zIikpOwp2YXIgaW1wb3J0X2xvZ2dlciA9IHJlcXVpcmUoIi4vbG9nZ2VyIik7CnZhciBpbXBvcnRfY29tbW9uID0gcmVxdWlyZSgiLi9jb21tb24iKTsKY29uc3QgcmVhZERpciA9ICgwLCBpbXBvcnRfdXRpbC5wcm9taXNpZnkpKGZzLnJlYWRkaXIpOwpjb25zdCByZWFkRmlsZSA9ICgwLCBpbXBvcnRfdXRpbC5wcm9taXNpZnkpKGZzLnJlYWRGaWxlKTsKY29uc3QgRU5WX0tFWVMgPSBbCiAgIkFEQVBURVJfSE9TVCIsCiAgIkFEQVBURVJfS0VZIiwKICAiQURBUFRFUl9QT1JUIiwKICAiREVCVUciLAogICJTWVNURU1fSUQiLAogICJXMV9ERVZJQ0VTX1BBVEgiCl07CmNsYXNzIERzMThiMjBSZW1vdGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgLyoqCiAgICAgKiBUaW1lb3V0IHRvIHRyaWdnZXIgc29ja2V0IHJlY29ubmVjdHMuCiAgICAgKi8KICAgIHRoaXMucmVjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICAvKioKICAgICAqIEZsYWcgaWYgZHMxOGIyMC1yZW1vdGUgc2hvdWxkIGV4aXQuCiAgICAgKiBJZiBgdHJ1ZWAgYSByZWNvbm5lY3Qgd29uJ3QgYmUgcG9zc2libGUuCiAgICAgKi8KICAgIHRoaXMuc2hvdWxkRXhpdCA9IGZhbHNlOwogICAgLyoqCiAgICAgKiBTdHJpbmcgb2YgdGhlIHJlY2VpdmVkIGRhdGEuCiAgICAgKiBBbGwgcmVjZWl2ZWQgZGF0YSBjaHVua3Mgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGlzIHVudGlsIHdlIGdvdCBgXG5gLgogICAgICogT24gYFxuYCBkYXRhIGJlZm9yZSBpdCB3aWxsIGJlIHByb2Nlc3NlZC4KICAgICAqLwogICAgdGhpcy5yZWN2RGF0YSA9ICIiOwogICAgdGhpcy5jb25uZWN0ID0gdGhpcy5jb25uZWN0LmJpbmQodGhpcyk7CiAgICB0aGlzLmV4aXQgPSB0aGlzLmV4aXQuYmluZCh0aGlzKTsKICAgIHRoaXMub25DbG9zZSA9IHRoaXMub25DbG9zZS5iaW5kKHRoaXMpOwogICAgdGhpcy5vbkRhdGEgPSB0aGlzLm9uRGF0YS5iaW5kKHRoaXMpOwogICAgdGhpcy5vbkVycm9yID0gdGhpcy5vbkVycm9yLmJpbmQodGhpcyk7CiAgICB0aGlzLm9uQ29ubmVjdCA9IHRoaXMub25Db25uZWN0LmJpbmQodGhpcyk7CiAgICB0aGlzLmxvZyA9IG5ldyBpbXBvcnRfbG9nZ2VyLkxvZ2dlcigpOwogICAgdGhpcy5sb2cubG9nKCItIGlvQnJva2VyLmRzMThiMjAgcmVtb3RlIGNsaWVudCAtIik7CiAgICB0aGlzLnJlYWREb3RFbnYoKTsKICAgIGlmIChwcm9jZXNzLmVudi5TWVNURU1fSUQpIHsKICAgICAgdGhpcy5zeXN0ZW1JZCA9IHByb2Nlc3MuZW52LlNZU1RFTV9JRC50cmltKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnN5c3RlbUlkID0gb3MuaG9zdG5hbWUoKTsKICAgICAgdGhpcy5sb2cud2FybihgVXNpbmcgdGhlIGhvc3RuYW1lICR7dGhpcy5zeXN0ZW1JZH0gYXMgc3lzdGVtIElELiBQbGVhc2Ugc2V0IFNZU1RFTV9JRCB0byBhIHVuaXF1ZSB2YWx1ZS5gKTsKICAgIH0KICAgIHRoaXMubG9nLmRlYnVnKGBzeXN0ZW1JZGAsIHRoaXMuc3lzdGVtSWQpOwogICAgaWYgKHByb2Nlc3MuZW52LkFEQVBURVJfUE9SVCkgewogICAgICB0cnkgewogICAgICAgIHRoaXMuYWRhcHRlclBvcnQgPSBwYXJzZUludChwcm9jZXNzLmVudi5BREFQVEVSX1BPUlQsIDEwKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhpcy5sb2cuZXJyb3IoYEludmFsaWQgQURBUFRFUl9QT1JUIWAsIGVycik7CiAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFkYXB0ZXJQb3J0ID0gMTgyMDsKICAgIH0KICAgIHRoaXMubG9nLmRlYnVnKGBhZGFwdGVyUG9ydGAsIHRoaXMuYWRhcHRlclBvcnQpOwogICAgdGhpcy5hZGFwdGVySG9zdCA9IChwcm9jZXNzLmVudi5BREFQVEVSX0hPU1QgPz8gIiIpLnRyaW0oKTsKICAgIGlmICh0aGlzLmFkYXB0ZXJIb3N0Lmxlbmd0aCA8PSAwKSB7CiAgICAgIHRoaXMubG9nLmVycm9yKGBObyBBREFQVEVSX0hPU1QgZ2l2ZW4hYCk7CiAgICAgIHByb2Nlc3MuZXhpdCgxKTsKICAgIH0KICAgIHRoaXMubG9nLmRlYnVnKGBhZGFwdGVySG9zdGAsIHRoaXMuYWRhcHRlckhvc3QpOwogICAgdGhpcy5hZGFwdGVyS2V5ID0gQnVmZmVyLmZyb20ocHJvY2Vzcy5lbnYuQURBUFRFUl9LRVkgPz8gIiIsICJoZXgiKTsKICAgIGlmICh0aGlzLmFkYXB0ZXJLZXkubGVuZ3RoICE9PSAzMikgewogICAgICB0aGlzLmxvZy5lcnJvcihgQURBUFRFUl9LRVkgaXMgbm8gdmFsaWQga2V5IWApOwogICAgICBwcm9jZXNzLmV4aXQoMSk7CiAgICB9CiAgICB0aGlzLmxvZy5kZWJ1ZyhgYWRhcHRlcktleWAsIHRoaXMuYWRhcHRlcktleSk7CiAgICB0aGlzLncxRGV2aWNlc1BhdGggPSBwcm9jZXNzLmVudi5XMV9ERVZJQ0VTX1BBVEggPz8gIi9zeXMvYnVzL3cxL2RldmljZXMiOwogICAgaWYgKCFmcy5leGlzdHNTeW5jKHRoaXMudzFEZXZpY2VzUGF0aCkpIHsKICAgICAgdGhpcy5sb2cuZXJyb3IoYFRoZSAxLXdpcmUgZGV2aWNlcyBwYXRoICR7dGhpcy53MURldmljZXNQYXRofSBkb2VzIG5vdCBleGlzdCFgKTsKICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgfQogICAgdGhpcy5sb2cuZGVidWcoYHcxRGV2aWNlc1BhdGhgLCB0aGlzLncxRGV2aWNlc1BhdGgpOwogICAgcHJvY2Vzcy5vbigiU0lHSU5UIiwgdGhpcy5leGl0KTsKICAgIHByb2Nlc3Mub24oIlNJR1RFUk0iLCB0aGlzLmV4aXQpOwogICAgdGhpcy5zb2NrZXQgPSBuZXcgaW1wb3J0X25ldC5Tb2NrZXQoKTsKICAgIHRoaXMuc29ja2V0Lm9uKCJjbG9zZSIsIHRoaXMub25DbG9zZSk7CiAgICB0aGlzLnNvY2tldC5vbigiZGF0YSIsIHRoaXMub25EYXRhKTsKICAgIHRoaXMuc29ja2V0Lm9uKCJlcnJvciIsIHRoaXMub25FcnJvcik7CiAgICB0aGlzLnNvY2tldC5vbigiY29ubmVjdCIsIHRoaXMub25Db25uZWN0KTsKICAgIHRoaXMuY29ubmVjdCgpOwogIH0KICAvKioKICAgKiBUcnkgdG8gY29ubmVjdCB0byB0aGUgYWRhcHRlci4KICAgKi8KICBjb25uZWN0KCkgewogICAgaWYgKHRoaXMucmVjb25uZWN0VGltZW91dCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy5yZWNvbm5lY3RUaW1lb3V0KTsKICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgIH0KICAgIGlmICh0aGlzLnNob3VsZEV4aXQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5sb2cuaW5mbyhgQ29ubmVjdGluZyB0byAke3RoaXMuYWRhcHRlckhvc3R9OiR7dGhpcy5hZGFwdGVyUG9ydH0gLi4uYCk7CiAgICB0aGlzLnNvY2tldC5jb25uZWN0KHsKICAgICAgaG9zdDogdGhpcy5hZGFwdGVySG9zdCwKICAgICAgcG9ydDogdGhpcy5hZGFwdGVyUG9ydAogICAgfSk7CiAgfQogIC8qKgogICAqIEhhbmRsZSBlc3RhYmxpc2hlZCBjb25uZWN0aW9uLgogICAqLwogIG9uQ29ubmVjdCgpIHsKICAgIHRoaXMubG9nLmluZm8oYENvbm5lY3RlZCB3aXRoIGFkYXB0ZXJgKTsKICAgIGlmICh0aGlzLnJlY29ubmVjdFRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVjb25uZWN0VGltZW91dCk7CiAgICB9CiAgICB0aGlzLnJlY29ubmVjdFRpbWVvdXQgPSBudWxsOwogIH0KICAvKioKICAgKiBIYW5kbGUgaW5jb21pbmcgZGF0YSBjaHVua3MuCiAgICogQHBhcmFtIGRhdGEgQSBkYXRhIGNodW5rLgogICAqLwogIG9uRGF0YShkYXRhKSB7CiAgICB0aGlzLnJlY3ZEYXRhICs9IGRhdGEudG9TdHJpbmcoKTsKICAgIGxldCBpZHggPSB0aGlzLnJlY3ZEYXRhLmluZGV4T2YoIlxuIik7CiAgICB3aGlsZSAoaWR4ID4gMCkgewogICAgICBjb25zdCByYXcgPSB0aGlzLnJlY3ZEYXRhLnNsaWNlKDAsIGlkeCk7CiAgICAgIHRoaXMucmVjdkRhdGEgPSB0aGlzLnJlY3ZEYXRhLnNsaWNlKGlkeCArIDEpOwogICAgICB2b2lkIHRoaXMuaGFuZGxlU29ja2V0RGF0YShyYXcpOwogICAgICBpZHggPSB0aGlzLnJlY3ZEYXRhLmluZGV4T2YoIlxuIik7CiAgICB9CiAgfQogIC8qKgogICAqIEhhbmRsZSBhIG1lc3NhZ2UgZnJvbSB0aGUgYWRhcHRlci4KICAgKiBAcGFyYW0gcmF3IFRoZSByYXcgKGVuY29kZWQpIG1lc3NhZ2UgZnJvbSB0aGUgYWRhcHRlci4KICAgKi8KICBhc3luYyBoYW5kbGVTb2NrZXREYXRhKHJhdykgewogICAgbGV0IGRhdGE7CiAgICB0cnkgewogICAgICBjb25zdCBkYXRhU3RyID0gKDAsIGltcG9ydF9jb21tb24uZGVjcnlwdCkocmF3LCB0aGlzLmFkYXB0ZXJLZXkpOwogICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhU3RyKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICB0aGlzLmxvZy53YXJuKGBEZWNyeXB0IG9mIGRhdGEgZmFpbGVkISAke2Vycn1gKTsKICAgICAgdGhpcy5zb2NrZXQuZW5kKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMubG9nLmRlYnVnKCJtZXNzYWdlIGZyb20gYWRhcHRlcjoiLCBkYXRhKTsKICAgIHN3aXRjaCAoZGF0YS5jbWQpIHsKICAgICAgY2FzZSAiY2xpZW50SW5mbyI6CiAgICAgICAgaWYgKGRhdGEucHJvdG9jb2xWZXJzaW9uICE9PSBpbXBvcnRfY29tbW9uLlJFTU9URV9QUk9UT0NPTF9WRVJTSU9OKSB7CiAgICAgICAgICB0aGlzLmxvZy53YXJuKGBQcm90b2NvbCB2ZXJzaW9uICR7ZGF0YS5wcm90b2NvbFZlcnNpb259IGZyb20gdGhlIGFkYXB0ZXIgZG9lcyBub3QgbWF0Y2ggdGhlIHJlbW90ZSBjbGllbnQgcHJvdG9jb2wgdmVyc2lvbiAke2ltcG9ydF9jb21tb24uUkVNT1RFX1BST1RPQ09MX1ZFUlNJT059ISBQbGVhc2UgcmVpbnN0YWxsIHRoZSByZW1vdGUgY2xpZW50LmApOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvZy5pbmZvKCJTZW5kaW5nIGNsaWVudCBpbmZvIHRvIHRoZSBhZGFwdGVyIik7CiAgICAgICAgYXdhaXQgdGhpcy5zZW5kKHsKICAgICAgICAgIGNtZDogImNsaWVudEluZm8iLAogICAgICAgICAgcHJvdG9jb2xWZXJzaW9uOiBpbXBvcnRfY29tbW9uLlJFTU9URV9QUk9UT0NPTF9WRVJTSU9OLAogICAgICAgICAgc3lzdGVtSWQ6IHRoaXMuc3lzdGVtSWQKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAicmVhZCI6IHsKICAgICAgICBpZiAoIWRhdGEuYWRkcmVzcykgewogICAgICAgICAgdGhpcy5sb2cud2FybihgR290IHJlYWQgY29tbWFuZCB3aXRob3V0IGFkZHJlc3MgZnJvbSBhZGFwdGVyIWApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgcmF3MjsKICAgICAgICB0cnkgewogICAgICAgICAgcmF3MiA9IGF3YWl0IHJlYWRGaWxlKGAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtkYXRhLmFkZHJlc3N9L3cxX3NsYXZlYCwgInV0ZjgiKTsKICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGBSZWFkIGZyb20gZmlsZSAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtkYXRhLmFkZHJlc3N9L3cxX3NsYXZlOmAsIHJhdyk7CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICB0aGlzLmxvZy53YXJuKGBSZWFkIGZyb20gZmlsZSAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtkYXRhLmFkZHJlc3N9L3cxX3NsYXZlIGZhaWxlZCEgJHtlcnJ9YCk7CiAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlcnIpOwogICAgICAgICAgcmF3MiA9ICIiOwogICAgICAgIH0KICAgICAgICBhd2FpdCB0aGlzLnNlbmQoewogICAgICAgICAgY21kOiAicmVhZCIsCiAgICAgICAgICBhZGRyZXNzOiBkYXRhLmFkZHJlc3MsCiAgICAgICAgICB0czogZGF0YS50cywKICAgICAgICAgIHJhdzogcmF3MgogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNhc2UgInNlYXJjaCI6CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgcmVhZERpcih0aGlzLncxRGV2aWNlc1BhdGgpOwogICAgICAgICAgY29uc3QgcHJvbXMgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgewogICAgICAgICAgICBpZiAoL153MV9idXNfbWFzdGVyXGQrJC8uZXhlYyhmaWxlKSkgewogICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKGByZWFkaW5nICR7dGhpcy53MURldmljZXNQYXRofS8ke2ZpbGV9L3cxX21hc3Rlcl9zbGF2ZXNgKTsKICAgICAgICAgICAgICBwcm9tcy5wdXNoKHJlYWRGaWxlKGAke3RoaXMudzFEZXZpY2VzUGF0aH0vJHtmaWxlfS93MV9tYXN0ZXJfc2xhdmVzYCwgInV0ZjgiKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZSA9PT0gIncxX21hc3Rlcl9zbGF2ZXMiKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoYHJlYWRpbmcgJHt0aGlzLncxRGV2aWNlc1BhdGh9L3cxX21hc3Rlcl9zbGF2ZXNgKTsKICAgICAgICAgICAgICBwcm9tcy5wdXNoKHJlYWRGaWxlKGAke3RoaXMudzFEZXZpY2VzUGF0aH0vdzFfbWFzdGVyX3NsYXZlc2AsICJ1dGY4IikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBhZGRyZXNzZXMgPSAoYXdhaXQgUHJvbWlzZS5hbGwocHJvbXMpKS5yZWR1Y2UoKGFjYywgY3VyKSA9PiB7CiAgICAgICAgICAgIGFjYy5wdXNoKC4uLmN1ci50cmltKCkuc3BsaXQoIlxuIikpOwogICAgICAgICAgICByZXR1cm4gYWNjOwogICAgICAgICAgfSwgW10pOwogICAgICAgICAgYXdhaXQgdGhpcy5zZW5kKHsKICAgICAgICAgICAgY21kOiAic2VhcmNoIiwKICAgICAgICAgICAgdHM6IGRhdGEudHMsCiAgICAgICAgICAgIHN5c3RlbUlkOiBkYXRhLnN5c3RlbUlkLAogICAgICAgICAgICBhZGRyZXNzZXMKICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgdGhpcy5sb2cud2FybihgU2VhcmNoaW5nIGZvciBzZW5zb3JzIGZhaWxlZCEgJHtlcnJ9YCk7CiAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZyhlcnIpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aGlzLmxvZy53YXJuKGBVbmtub3duIGNvbW1hbmQgZnJvbSBhZGFwdGVyYCk7CiAgICB9CiAgfQogIC8qKgogICAqIEhhbmRsZXIgZm9yIHNvY2tldCBlcnJvcnMuCiAgICogRWFjaCBlcnJvciB3aWxsIHRyaWdnZXIgYSBzb2NrZXQgZGlzY29ubmVjdCBhbmQgcmVjb25uZWN0LgogICAqIEBwYXJhbSBlcnIgVGhlIGVycm9yLgogICAqLwogIG9uRXJyb3IoZXJyKSB7CiAgICB0aGlzLmxvZy53YXJuKGBTb2NrZXQgZXJyb3I6YCwgZXJyLnRvU3RyaW5nKCkpOwogICAgdGhpcy5sb2cuZGVidWcoZXJyKTsKICAgIHRoaXMuc29ja2V0LmVuZCgpOwogICAgdGhpcy5yZWNvbm5lY3QoKTsKICB9CiAgLyoqCiAgICogSGFuZGxlciBmb3Igc29ja2V0IGNsb3NlIGV2ZW50cy4KICAgKi8KICBvbkNsb3NlKCkgewogICAgdGhpcy5sb2cuaW5mbygiU29ja2V0IGNsb3NlZCIpOwogICAgdGhpcy5yZWNvbm5lY3QoKTsKICB9CiAgLyoqCiAgICogSW5pdCBhIHJlY29ubmVjdCBhZnRlciAzMCBzZWNvbmRzLgogICAqLwogIHJlY29ubmVjdCgpIHsKICAgIGlmICghdGhpcy5yZWNvbm5lY3RUaW1lb3V0ICYmICF0aGlzLnNob3VsZEV4aXQpIHsKICAgICAgdGhpcy5sb2cuaW5mbyhgUmVjb25uZWN0IGluIDMwIHNlY29uZHNgKTsKICAgICAgdGhpcy5yZWNvbm5lY3RUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLmNvbm5lY3QsIDNlNCk7CiAgICB9CiAgfQogIC8qKgogICAqIFNlbmQgc29tZSBkYXRhIHRvIHRoZSBhZGFwdGVyLgogICAqIFRoZSBkYXRhIHdpbGwgYmUgc3RyaW5naWZpZWQgYW5kIGVuY3J5cHRlZCBiZWZvcmUgc2VuZGluZy4KICAgKiBAcGFyYW0gZGF0YSBUaGUgZGF0YSBvYmplY3QgdG8gc2VuZC4KICAgKi8KICBhc3luYyBzZW5kKGRhdGEpIHsKICAgIHRoaXMubG9nLmRlYnVnKCJzZW5kIHRvIGFkYXB0ZXI6IiwgZGF0YSk7CiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICB0aGlzLnNvY2tldC53cml0ZSgoMCwgaW1wb3J0X2NvbW1vbi5lbmNyeXB0KShKU09OLnN0cmluZ2lmeShkYXRhKSwgdGhpcy5hZGFwdGVyS2V5KSArICJcbiIsIChlcnIpID0+IHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9CiAgLyoqCiAgICogUmVhZCBlbnYgdmFycyBmcm9tIGEgLmVudiBmaWxlIGluIHRoZSBjdXJyZW50IHdvcmtpbmcgZGlyIGlmIGV4aXN0cy4KICAgKi8KICByZWFkRG90RW52KCkgewogICAgaWYgKCFmcy5leGlzdHNTeW5jKCIuZW52IikpCiAgICAgIHJldHVybjsKICAgIGxldCBkYXRhOwogICAgdHJ5IHsKICAgICAgZGF0YSA9IGZzLnJlYWRGaWxlU3luYygiLmVudiIsICJ1dGYtOCIpLnNwbGl0KCJcbiIpLm1hcCgobCkgPT4gbC50cmltKCkpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHRoaXMubG9nLmRlYnVnKCJjYW4ndCByZWFkIC5lbnYgZmlsZSIsIGVycik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgbGluZSBvZiBkYXRhKSB7CiAgICAgIGlmICghbGluZSB8fCBsaW5lLnN0YXJ0c1dpdGgoIiMiKSkKICAgICAgICBjb250aW51ZTsKICAgICAgY29uc3QgaWR4ID0gbGluZS5pbmRleE9mKCI9Iik7CiAgICAgIGlmIChpZHggPD0gMCkKICAgICAgICBjb250aW51ZTsKICAgICAgY29uc3Qga2V5ID0gbGluZS5zbGljZSgwLCBpZHgpLnRyaW0oKTsKICAgICAgY29uc3QgdmFsID0gbGluZS5zbGljZShpZHggKyAxKS50cmltKCkucmVwbGFjZSgvKF4ifCIkKS9nLCAiIik7CiAgICAgIGlmIChFTlZfS0VZUy5pbmNsdWRlcyhrZXkpKSB7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52W2tleV0pCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICBwcm9jZXNzLmVudltrZXldID0gdmFsOwogICAgICAgIHRoaXMubG9nLmRlYnVnKGByZWFkICR7a2V5fT0ke3ZhbH0gZnJvbSAuZW52IGZpbGVgKTsKICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBIYW5kbGVyIHByb2Nlc3MgZXhpdC4KICAgKiBUaGlzIHdpbGwgc3RvcCBhbGwgdGltZW91dHMgYW5kIGNsb3NlIHRoZSBzb2NrZXQgY29ubmVjdGlvbi4KICAgKi8KICBleGl0KCkgewogICAgdGhpcy5zaG91bGRFeGl0ID0gdHJ1ZTsKICAgIGlmICh0aGlzLnJlY29ubmVjdFRpbWVvdXQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVjb25uZWN0VGltZW91dCk7CiAgICB9CiAgICB0aGlzLnNvY2tldC5lbmQoKTsKICB9Cn0KbmV3IERzMThiMjBSZW1vdGUoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZHMxOGIyMC1yZW1vdGUtY2xpZW50LmpzLm1hcAo=',
'logger.js': 'InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CnZhciBsb2dnZXJfZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChsb2dnZXJfZXhwb3J0cywgewogIExvZ2dlcjogKCkgPT4gTG9nZ2VyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhsb2dnZXJfZXhwb3J0cyk7CmNsYXNzIExvZ2dlciB7CiAgLyoqCiAgICogTG9nIGEgbWVzc2FnZS4KICAgKiBAcGFyYW0gYXJncyBUaGluZ3MgdG8gbG9nLgogICAqLwogIGxvZyguLi5hcmdzKSB7CiAgICBjb25zb2xlLmxvZyguLi5hcmdzKTsKICB9CiAgLyoqCiAgICogTG9nIGEgbWVzc2FnZSBwcmVwZW5kZWQgd2l0aCBgW0RlYnVnXWAuCiAgICogVGhlIG1lc3NhZ2Ugd2lsbCBvbmx5IGJlIGxvZ2dlZCBpZiBgcHJvY2Vzcy5lbnYuREVCVUdgIGlzIGEgdHJ1dGh5IHZhbHVlLgogICAqIEBwYXJhbSBhcmdzIFRoaW5ncyB0byBsb2cuCiAgICovCiAgZGVidWcoLi4uYXJncykgewogICAgaWYgKCFwcm9jZXNzLmVudi5ERUJVRykgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zb2xlLmxvZygiW0RlYnVnXSIsIC4uLmFyZ3MpOwogIH0KICAvKioKICAgKiBMb2cgYSBtZXNzYWdlIHByZXBlbmRlZCB3aXRoIGBbSW5mb11gLgogICAqIEBwYXJhbSBhcmdzIFRoaW5ncyB0byBsb2cuCiAgICovCiAgaW5mbyguLi5hcmdzKSB7CiAgICBjb25zb2xlLmxvZygiW0luZm9dIiwgLi4uYXJncyk7CiAgfQogIC8qKgogICAqIExvZyBhbiBlcnJvciBtZXNzYWdlIHByZXBlbmRlZCB3aXRoIGBbV2Fybl1gLgogICAqIEBwYXJhbSBhcmdzIFRoaW5ncyB0byBsb2cuCiAgICovCiAgd2FybiguLi5hcmdzKSB7CiAgICBjb25zb2xlLndhcm4oIltXYXJuXSIsIC4uLmFyZ3MpOwogIH0KICAvKioKICAgKiBMb2cgYW4gZXJyb3IgbWVzc2FnZSBwcmVwZW5kZWQgd2l0aCBgW0Vycm9yXWAuCiAgICogQHBhcmFtIGFyZ3MgVGhpbmdzIHRvIGxvZy4KICAgKi8KICBlcnJvciguLi5hcmdzKSB7CiAgICBjb25zb2xlLmVycm9yKCJbRXJyb3JdIiwgLi4uYXJncyk7CiAgfQp9Ci8vIEFubm90YXRlIHRoZSBDb21tb25KUyBleHBvcnQgbmFtZXMgZm9yIEVTTSBpbXBvcnQgaW4gbm9kZToKMCAmJiAobW9kdWxlLmV4cG9ydHMgPSB7CiAgTG9nZ2VyCn0pOwovLyMgc291cmNlTWFwcGluZ1VSTD1sb2dnZXIuanMubWFwCg=='
  // will be replaced during remote-client-setup creation
};
for (const f in files) {
  const content = Buffer.from(files[f], "base64").toString("utf-8");
  fs.writeFileSync(f, content, { encoding: "utf-8" });
}
const systemDContent = `[Unit]
Description=ioBroker.ds18b20 remote client
Documentation=https://github.com/crycode-de/ioBroker.ds18b20
After=network.target

[Service]
Type=simple
User=${os.userInfo().username}
WorkingDirectory=${__dirname}
ExecStart=${process.execPath} ${path.join(__dirname, "ds18b20-remote-client.js")}
Restart=on-failure

[Install]
WantedBy=multi-user.target
`;
const systemDFile = path.join(__dirname, SYSTEMD_SERVICE_NAME);
fs.writeFileSync(systemDFile, systemDContent, { encoding: "utf-8" });
const dotEnvContent = `# Settings for the ioBroker.ds18b20 remote client

# Unique ID for this remote system
SYSTEM_ID=my-remote

# IP or hostname of the ioBroker host running the adapter
ADAPTER_HOST=

# Port from the adapter config
ADAPTER_PORT=1820

# Encryption key from the adapter config
ADAPTER_KEY=

# Enable debug log output
#DEBUG=1

# System path of the 1-wire devices
#W1_DEVICES_PATH=/sys/bus/w1/devices
`;
const dotEnvFile = path.join(__dirname, ".env");
if (!fs.existsSync(dotEnvFile)) {
  fs.writeFileSync(dotEnvFile, dotEnvContent, { encoding: "utf-8" });
}
console.log(`- ioBroker.ds18b20 remote client -

Basic setup done.

Please adjust the settings in the .env file.

To manually start the client just run:
  node ds18b20-remote-client.js

To setup the SystemD service, please run:
  sudo cp ${SYSTEMD_SERVICE_NAME} /etc/systemd/system/${SYSTEMD_SERVICE_NAME}
  sudo systemctl daemon-reload
  sudo systemctl enable ${SYSTEMD_SERVICE_NAME}
  sudo systemctl start ${SYSTEMD_SERVICE_NAME}
`);

